---
- name: common setup
  hosts: all
  vars:
    target_env: "{{ lookup('env', 'target') }}"
  vars_files:
  #- /root/.qcacode
  strategy: free
  roles:
  - app-agent
  - appctl-1.3.0
  - arping
  - common
  - caddy
  - disable-package-manager-timers
  - disable-motd

  tasks:
  - include_role:
      name: "{{ svc_name }}"
    when: "'opensearch' in group_names"
    loop:
    - jq
    - node-exporter
    - opensearch
    - opensearch-plugins
    - node-opensearch
    loop_control:
      loop_var: svc_name

  # - include_role:
  #     name: java-1.0.1
  #   vars:
  #     java_version: 8
  #   when: ('opensearchDashboards' in group_names) or ('' in group_names)

  # - include_role:
  #     name: "{{ svc_name }}"
  #   when: "'logstash' in group_names"
  #   loop:
  #   - jq-1.0.9
  #   - logstash
  #   - node-logstash
  #   loop_control:
  #     loop_var: svc_name

  # - include_role:
  #     name: "{{ svc_name }}"
  #   when: "'opensearchDashboards' in group_names"
  #   loop:
  #   - opensearchDashboards
  #   - haproxy-1.0.8
  #   - keepalived-1.0.6
  #   - cerebro
  #   - node-opensearchDashboards
  #   loop_control:
  #     loop_var: svc_name
